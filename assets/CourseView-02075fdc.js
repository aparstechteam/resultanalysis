import{u as H,r as d,a as I,o as l,c,b as e,d as C,w as q,e as B,n as R,F as $,f as D,g as j,h as y,v as w,i as F,j as m,k as p,t as x,l as J}from"./index-e2b4287e.js";import{_ as k}from"./lodash-fb661e38.js";const M={class:"pb-10"},O={class:"space-x-2 text-center"},G={class:"max-w-xl p-3 mx-auto my-5 space-y-3 rounded-lg"},K={class:""},X={class:"flex items-center text-xl font-semibold"},z={key:0,class:"text-green-500"},P=e("span",{class:"material-icons"}," done ",-1),W=[P],Y={key:1,class:"text-red-500"},Z=e("span",{class:"material-icons"}," close ",-1),ee=[Z],te={class:"flex gap-3 mt-3"},se={class:"btn btn-sm"},oe=["href"],ae=e("img",{class:"w-6 h-6",src:"https://img.icons8.com/fluency/48/google-sheets.png",alt:"google-sheets"},null,-1),ne=["onClick"],le=e("span",{class:"text-red-500 material-icons"}," delete ",-1),ce=e("span",{class:"material-icons"}," send ",-1),ie={class:"w-[450px] mx-auto border card"},re={class:"card-body"},ue=e("h2",{class:"text-xl font-semibold"},"Add Exam",-1),de=["onSubmit"],me=e("button",{class:"btn"},"Add Exam",-1),pe={class:"flex"},he={key:0,class:"max-w-4xl mx-auto mt-3"},_e=e("h1",{class:"text-xl font-semibold"},"Exam List",-1),xe={class:"overflow-x-auto"},ve={class:"table"},be=e("thead",null,[e("tr",null,[e("th",null,"SL No"),e("th",null,"Topic"),e("th",null,"Exam"),e("th",null,"Actions")])],-1),ge=["href"],fe=e("img",{class:"w-6 h-6",src:"https://img.icons8.com/fluency/48/google-sheets.png",alt:"google-sheets"},null,-1),ye=["onClick"],we=e("span",{class:"material-icons"}," delete ",-1),Be={__name:"CourseView",setup(ke){const i=H().params.id,n=d({name:"",course:i,question:""}),h=d([]),v=async()=>{const o=await m.get(`/exam/${i}/course`);h.value=o.data};v();const L=async()=>{const o=await m.post("/exam",{name:n.value.name,course:n.value.course,question:n.value.question.substr(39,44)});h.value.push(o.data),n.value={name:"",course:i,question:""}},S=async o=>{await m.delete(`/exam/${o}`),v()},b=d(""),r=d([]),T=async()=>{const o=await m.get(`https://script.google.com/macros/s/AKfycbxEnSLBrQ3eGYvAIJwU0ykmUzxqIWDHg8swwnuevhha59AO6NEXpX_ux5PC_KfywQU4/exec?s=${b.value.substr(39,44)}&sname=examlist`);r.value=o.data.map(s=>({id:s.id,name:s.topic,course:i,question:s.exam.substr(39,44)})).filter(s=>s.name)},V=o=>{r.value=r.value.filter(s=>s.id!==o)},A=async()=>{await m.post("/exam/import",r.value),r.value=[],v()},g=d([]),_=d(!1),N=async o=>{if(o.totalResponses==0){_.value=!0;try{let s="https://script.google.com/macros/s/AKfycbxHZMx1M1oGvp-wPb7mHwQrfkDBpkS3BG0WtciUJ_HHJTswLgJ2Ba4f8XBLNHOkjYEERQ/exec?sheet="+o.question,t=await(await J.get(s)).data;t=k.sortBy(t.map(a=>({...a,attempt:a.attempt||1,duration:a.duration||a["duration "]})),[a=>-a.score,"duration"]).map((a,E)=>({rank:E+1,...a,course:i,exam_id:o._id})),g.value=[...g.value,...t],o.totalResponses=t.length,_.value=!1}catch(s){console.log(s),_.value=!1}}else return},f=d(!1),Q=async()=>{h.value.forEach(o=>{N(o)})},U=()=>{let o=k.groupBy(g.value,"exam_id");k.shuffle(Object.keys(o)).forEach(async s=>{try{console.log(s);const u=await m.post("/result",o[s]);console.log(u),f.value=!1}catch(u){console.log(u),f.value=!1}})};return(o,s)=>{const u=I("router-link");return l(),c("div",M,[e("div",null,[e("div",O,[C(u,{to:`/course/result/${B(i)}`,class:"btn"},{default:q(()=>[p(" Overall Course Result ")]),_:1},8,["to"]),e("button",{onClick:Q,class:R(["btn",{loading:_.value}])},"Fetch Result",2),e("button",{onClick:U,class:R(["btn",{loading:f.value}])},"Import",2)]),e("div",G,[(l(!0),c($,null,D(h.value,t=>(l(),c("div",{class:"flex items-center justify-between p-3 border rounded-lg",key:t._id},[e("div",K,[e("h1",X,[p(x(t.name),1),t.isImported?(l(),c("span",z,W)):(l(),c("span",Y,ee))]),e("div",te,[e("span",se," Total: "+x(t.totalResponses),1),e("a",{class:"btn btn-sm",href:`https://docs.google.com/spreadsheets/d/${t.question}/edit#gid=1573239885`},[p(" Question "),ae],8,oe),e("button",{class:"btn btn-sm btn-danger",onClick:a=>S(t._id)},[p(" Delete "),le],8,ne)])]),C(u,{to:`/exam/import/${B(i)}/${t._id}`,class:"border shadow-md btn btn-circle"},{default:q(()=>[ce]),_:2},1032,["to"])]))),128))])]),e("div",ie,[e("div",re,[ue,e("form",{onSubmit:j(L,["prevent"]),class:"flex flex-col gap-3"},[y(e("input",{type:"text",placeholder:"Exam Topic","onUpdate:modelValue":s[0]||(s[0]=t=>n.value.name=t),class:"input input-bordered"},null,512),[[w,n.value.name]]),y(e("input",{type:"text",placeholder:"Question Link","onUpdate:modelValue":s[1]||(s[1]=t=>n.value.question=t),class:"input input-bordered"},null,512),[[w,n.value.question]]),me],40,de),e("div",pe,[y(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=t=>b.value=t),placeholder:"Exam list sheet",class:"flex-1 mr-2 input input-bordered"},null,512),[[w,b.value]]),e("button",{class:"btn",onClick:T},"Fetch Sheet")])])]),r.value.length>0?(l(),c("div",he,[e("div",{class:"mb-3 text-center"},[_e,e("button",{class:"btn",onClick:A}," Import ")]),e("div",xe,[e("table",ve,[be,e("tbody",null,[(l(!0),c($,null,D(r.value,(t,a)=>(l(),c("tr",{key:a},[e("th",null,x(a+1),1),e("td",null,x(t.name),1),e("td",null,[e("a",{class:"btn btn-sm",href:`https://docs.google.com/spreadsheets/d/${t.question}/edit#gid=1573239885`},[p(" Question "),fe],8,ge)]),e("td",null,[e("button",{class:"text-white btn btn-sm btn-error",onClick:E=>V(t.id)},[p(" Delete "),we],8,ye)])]))),128))])])])])):F("",!0)])}}};export{Be as default};
