import{u as U,r as d,a as H,o as n,c,b as e,d as C,w as q,e as B,n as R,t as p,F as T,f as $,g as j,h as y,v as w,i as F,j as h,k as _,l as J}from"./index-19606eaf.js";import{_ as k}from"./lodash-fb661e38.js";const M={class:"pb-10"},O={class:"space-x-2 text-center"},G={class:"mt-4 text-center"},K={class:"max-w-xl p-3 mx-auto my-5 space-y-3 rounded-lg"},X={class:""},z={class:"flex items-center text-xl font-semibold"},P={key:0,class:"text-green-500"},W=e("span",{class:"material-icons"}," done ",-1),Y=[W],Z={key:1,class:"text-red-500"},ee=e("span",{class:"material-icons"}," close ",-1),te=[ee],se={class:"flex gap-3 mt-3"},oe={class:"btn btn-sm"},ae=["href"],le=e("img",{class:"w-6 h-6",src:"https://img.icons8.com/fluency/48/google-sheets.png",alt:"google-sheets"},null,-1),ne=["onClick"],ce=e("span",{class:"text-red-500 material-icons"}," delete ",-1),ie=e("span",{class:"material-icons"}," send ",-1),re={class:"w-[450px] mx-auto border card"},ue={class:"card-body"},de=e("h2",{class:"text-xl font-semibold"},"Add Exam",-1),me=["onSubmit"],pe=e("button",{class:"btn"},"Add Exam",-1),he={class:"flex"},_e={key:0,class:"max-w-4xl mx-auto mt-3"},xe=e("h1",{class:"text-xl font-semibold"},"Exam List",-1),ve={class:"overflow-x-auto"},be={class:"table"},ge=e("thead",null,[e("tr",null,[e("th",null,"SL No"),e("th",null,"Topic"),e("th",null,"Exam"),e("th",null,"Actions")])],-1),fe=["href"],ye=e("img",{class:"w-6 h-6",src:"https://img.icons8.com/fluency/48/google-sheets.png",alt:"google-sheets"},null,-1),we=["onClick"],ke=e("span",{class:"material-icons"}," delete ",-1),Re={__name:"CourseView",setup(Ee){const i=U().params.id,l=d({name:"",course:i,question:""}),m=d([]),v=async()=>{const o=await h.get(`/exam/${i}/course`);m.value=o.data.filter(s=>!s.isImported)};v();const D=async()=>{const o=await h.post("/exam",{name:l.value.name,course:l.value.course,question:l.value.question.substr(39,44)});m.value.push(o.data),l.value={name:"",course:i,question:""}},I=async o=>{await h.delete(`/exam/${o}`),v()},b=d(""),r=d([]),L=async()=>{const o=await h.get(`https://script.google.com/macros/s/AKfycbxEnSLBrQ3eGYvAIJwU0ykmUzxqIWDHg8swwnuevhha59AO6NEXpX_ux5PC_KfywQU4/exec?s=${b.value.substr(39,44)}&sname=examlist`);r.value=o.data.map(s=>({id:s.id,name:s.topic,course:i,question:s.exam.substr(39,44)})).filter(s=>s.name)},S=o=>{r.value=r.value.filter(s=>s.id!==o)},V=async()=>{await h.post("/exam/import",r.value),r.value=[],v()},g=d([]),x=d(!1),A=async o=>{if(o.totalResponses==0){x.value=!0;try{let s="https://script.google.com/macros/s/AKfycbxHZMx1M1oGvp-wPb7mHwQrfkDBpkS3BG0WtciUJ_HHJTswLgJ2Ba4f8XBLNHOkjYEERQ/exec?sheet="+o.question,t=await(await J.get(s)).data;t=k.sortBy(t.map(a=>({...a,attempt:a.attempt||1,duration:a.duration||a["duration "]})),[a=>-a.score,"duration"]).map((a,E)=>({rank:E+1,...a,course:i,exam_id:o._id})),g.value=[...g.value,...t],o.totalResponses=t.length,x.value=!1}catch(s){console.log(s),x.value=!1}}else return},f=d(!1),N=async()=>{m.value.forEach(o=>{A(o)})},Q=()=>{let o=k.groupBy(g.value,"exam_id");k.shuffle(Object.keys(o)).forEach(async s=>{try{const u=await h.post("/result",o[s]);console.log(u),f.value=!1}catch(u){console.log(u),f.value=!1}})};return(o,s)=>{const u=H("router-link");return n(),c("div",M,[e("div",null,[e("div",O,[C(u,{to:`/course/result/${B(i)}`,class:"btn"},{default:q(()=>[_(" Overall Course Result ")]),_:1},8,["to"]),e("button",{onClick:N,class:R(["btn",{loading:x.value}])},"Fetch Result",2),e("button",{onClick:Q,class:R(["btn",{loading:f.value}])},"Import",2)]),e("div",G,[e("p",null," Total Exams: "+p(m.value.length),1),e("p",null," Total Imported: "+p(m.value.filter(t=>t.isImported).length),1)]),e("div",K,[(n(!0),c(T,null,$(m.value,t=>(n(),c("div",{class:"flex items-center justify-between p-3 border rounded-lg",key:t._id},[e("div",X,[e("h1",z,[_(p(t.name),1),t.isImported?(n(),c("span",P,Y)):(n(),c("span",Z,te))]),e("div",se,[e("span",oe," Total: "+p(t.totalResponses),1),e("a",{class:"btn btn-sm",href:`https://docs.google.com/spreadsheets/d/${t.question}/edit#gid=1573239885`},[_(" Question "),le],8,ae),e("button",{class:"btn btn-sm btn-danger",onClick:a=>I(t._id)},[_(" Delete "),ce],8,ne)])]),C(u,{to:`/exam/import/${B(i)}/${t._id}`,class:"border shadow-md btn btn-circle"},{default:q(()=>[ie]),_:2},1032,["to"])]))),128))])]),e("div",re,[e("div",ue,[de,e("form",{onSubmit:j(D,["prevent"]),class:"flex flex-col gap-3"},[y(e("input",{type:"text",placeholder:"Exam Topic","onUpdate:modelValue":s[0]||(s[0]=t=>l.value.name=t),class:"input input-bordered"},null,512),[[w,l.value.name]]),y(e("input",{type:"text",placeholder:"Question Link","onUpdate:modelValue":s[1]||(s[1]=t=>l.value.question=t),class:"input input-bordered"},null,512),[[w,l.value.question]]),pe],40,me),e("div",he,[y(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=t=>b.value=t),placeholder:"Exam list sheet",class:"flex-1 mr-2 input input-bordered"},null,512),[[w,b.value]]),e("button",{class:"btn",onClick:L},"Fetch Sheet")])])]),r.value.length>0?(n(),c("div",_e,[e("div",{class:"mb-3 text-center"},[xe,e("button",{class:"btn",onClick:V}," Import ")]),e("div",ve,[e("table",be,[ge,e("tbody",null,[(n(!0),c(T,null,$(r.value,(t,a)=>(n(),c("tr",{key:a},[e("th",null,p(a+1),1),e("td",null,p(t.name),1),e("td",null,[e("a",{class:"btn btn-sm",href:`https://docs.google.com/spreadsheets/d/${t.question}/edit#gid=1573239885`},[_(" Question "),ye],8,fe)]),e("td",null,[e("button",{class:"text-white btn btn-sm btn-error",onClick:E=>S(t.id)},[_(" Delete "),ke],8,we)])]))),128))])])])])):F("",!0)])}}};export{Re as default};
