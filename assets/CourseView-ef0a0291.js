import{u as U,r as d,a as H,o as l,c,b as e,d as C,w as q,e as B,n as R,F as $,f as D,g as j,h as y,v as w,i as F,j as m,k as p,t as x,l as J}from"./index-5e8438b6.js";import{_ as k}from"./lodash-fb661e38.js";const M={class:"pb-10"},O={class:"space-x-2 text-center"},G={class:"max-w-xl p-3 mx-auto my-5 space-y-3 rounded-lg"},K={class:""},X={class:"flex items-center text-xl font-semibold"},z={key:0,class:"text-green-500"},P=e("span",{class:"material-icons"}," done ",-1),W=[P],Y={key:1,class:"text-red-500"},Z=e("span",{class:"material-icons"}," close ",-1),ee=[Z],te={class:"flex gap-3 mt-3"},se={class:"btn btn-sm"},oe=["href"],ae=e("img",{class:"w-6 h-6",src:"https://img.icons8.com/fluency/48/google-sheets.png",alt:"google-sheets"},null,-1),ne=["onClick"],le=e("span",{class:"text-red-500 material-icons"}," delete ",-1),ce=e("span",{class:"material-icons"}," send ",-1),ie={class:"w-[450px] mx-auto border card"},re={class:"card-body"},ue=e("h2",{class:"text-xl font-semibold"},"Add Exam",-1),de=["onSubmit"],me=e("button",{class:"btn"},"Add Exam",-1),pe={class:"flex"},he={key:0,class:"max-w-4xl mx-auto mt-3"},_e=e("h1",{class:"text-xl font-semibold"},"Exam List",-1),xe={class:"overflow-x-auto"},ve={class:"table"},be=e("thead",null,[e("tr",null,[e("th",null,"SL No"),e("th",null,"Topic"),e("th",null,"Exam"),e("th",null,"Actions")])],-1),fe=["href"],ge=e("img",{class:"w-6 h-6",src:"https://img.icons8.com/fluency/48/google-sheets.png",alt:"google-sheets"},null,-1),ye=["onClick"],we=e("span",{class:"material-icons"}," delete ",-1),Be={__name:"CourseView",setup(ke){const i=U().params.id,n=d({name:"",course:i,question:""}),h=d([]),v=async()=>{const o=await m.get(`/exam/${i}/course`);h.value=o.data.filter(t=>!t.isImported)};v();const L=async()=>{const o=await m.post("/exam",{name:n.value.name,course:n.value.course,question:n.value.question.substr(39,44)});h.value.push(o.data),n.value={name:"",course:i,question:""}},S=async o=>{await m.delete(`/exam/${o}`),v()},b=d(""),r=d([]),T=async()=>{const o=await m.get(`https://script.google.com/macros/s/AKfycbxEnSLBrQ3eGYvAIJwU0ykmUzxqIWDHg8swwnuevhha59AO6NEXpX_ux5PC_KfywQU4/exec?s=${b.value.substr(39,44)}&sname=examlist`);r.value=o.data.map(t=>({id:t.id,name:t.topic,course:i,question:t.exam.substr(39,44)})).filter(t=>t.name)},V=o=>{r.value=r.value.filter(t=>t.id!==o)},A=async()=>{await m.post("/exam/import",r.value),r.value=[],v()},f=d([]),_=d(!1),I=async o=>{if(o.totalResponses==0){_.value=!0;try{let t="https://script.google.com/macros/s/AKfycbxHZMx1M1oGvp-wPb7mHwQrfkDBpkS3BG0WtciUJ_HHJTswLgJ2Ba4f8XBLNHOkjYEERQ/exec?sheet="+o.question,s=await(await J.get(t)).data;s=k.sortBy(s.map(a=>({...a,attempt:a.attempt||1,duration:a.duration||a["duration "]})),[a=>-a.score,"duration"]).map((a,E)=>({rank:E+1,...a,course:i,exam_id:o._id})),f.value=[...f.value,...s],o.totalResponses=s.length,_.value=!1}catch(t){console.log(t),_.value=!1}}else return},g=d(!1),N=async()=>{h.value.forEach(o=>{I(o)})},Q=()=>{let o=k.groupBy(f.value,"exam_id");k.shuffle(Object.keys(o)).forEach(async t=>{try{const u=await m.post("/result",o[t]);console.log(u),g.value=!1}catch(u){console.log(u),g.value=!1}})};return(o,t)=>{const u=H("router-link");return l(),c("div",M,[e("div",null,[e("div",O,[C(u,{to:`/course/result/${B(i)}`,class:"btn"},{default:q(()=>[p(" Overall Course Result ")]),_:1},8,["to"]),e("button",{onClick:N,class:R(["btn",{loading:_.value}])},"Fetch Result",2),e("button",{onClick:Q,class:R(["btn",{loading:g.value}])},"Import",2)]),e("div",G,[(l(!0),c($,null,D(h.value,s=>(l(),c("div",{class:"flex items-center justify-between p-3 border rounded-lg",key:s._id},[e("div",K,[e("h1",X,[p(x(s.name),1),s.isImported?(l(),c("span",z,W)):(l(),c("span",Y,ee))]),e("div",te,[e("span",se," Total: "+x(s.totalResponses),1),e("a",{class:"btn btn-sm",href:`https://docs.google.com/spreadsheets/d/${s.question}/edit#gid=1573239885`},[p(" Question "),ae],8,oe),e("button",{class:"btn btn-sm btn-danger",onClick:a=>S(s._id)},[p(" Delete "),le],8,ne)])]),C(u,{to:`/exam/import/${B(i)}/${s._id}`,class:"border shadow-md btn btn-circle"},{default:q(()=>[ce]),_:2},1032,["to"])]))),128))])]),e("div",ie,[e("div",re,[ue,e("form",{onSubmit:j(L,["prevent"]),class:"flex flex-col gap-3"},[y(e("input",{type:"text",placeholder:"Exam Topic","onUpdate:modelValue":t[0]||(t[0]=s=>n.value.name=s),class:"input input-bordered"},null,512),[[w,n.value.name]]),y(e("input",{type:"text",placeholder:"Question Link","onUpdate:modelValue":t[1]||(t[1]=s=>n.value.question=s),class:"input input-bordered"},null,512),[[w,n.value.question]]),me],40,de),e("div",pe,[y(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),placeholder:"Exam list sheet",class:"flex-1 mr-2 input input-bordered"},null,512),[[w,b.value]]),e("button",{class:"btn",onClick:T},"Fetch Sheet")])])]),r.value.length>0?(l(),c("div",he,[e("div",{class:"mb-3 text-center"},[_e,e("button",{class:"btn",onClick:A}," Import ")]),e("div",xe,[e("table",ve,[be,e("tbody",null,[(l(!0),c($,null,D(r.value,(s,a)=>(l(),c("tr",{key:a},[e("th",null,x(a+1),1),e("td",null,x(s.name),1),e("td",null,[e("a",{class:"btn btn-sm",href:`https://docs.google.com/spreadsheets/d/${s.question}/edit#gid=1573239885`},[p(" Question "),ge],8,fe)]),e("td",null,[e("button",{class:"text-white btn btn-sm btn-error",onClick:E=>V(s.id)},[p(" Delete "),we],8,ye)])]))),128))])])])])):F("",!0)])}}};export{Be as default};
